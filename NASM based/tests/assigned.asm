	PAGE $0
	ORG $C000

CodeBegin:

CharTable:
	FCB $0,$0,$0,$0,$0,$0,$0,$0
	FCB $20,$20,$20,$20,$20,$0,$20,$0
	FCB $50,$50,$50,$0,$0,$0,$0,$0
	FCB $50,$50,$F8,$50,$F8,$50,$50,$0
	FCB $20,$F0,$28,$70,$A0,$78,$20,$0
	FCB $18,$98,$40,$20,$10,$C8,$C0,$0
	FCB $30,$48,$28,$10,$A8,$48,$B0,$0
	FCB $18,$10,$8,$0,$0,$0,$0,$0
	FCB $20,$10,$8,$8,$8,$10,$20,$0
	FCB $20,$40,$80,$80,$80,$40,$20,$0
	FCB $0,$20,$A8,$70,$A8,$20,$0,$0
	FCB $0,$20,$20,$F8,$20,$20,$0,$0
	FCB $0,$0,$0,$0,$0,$30,$20,$10
	FCB $0,$0,$0,$F8,$0,$0,$0,$0
	FCB $0,$0,$0,$0,$0,$30,$30,$0
	FCB $0,$80,$40,$20,$10,$8,$0,$0
	FCB $70,$88,$C8,$A8,$98,$88,$70,$0
	FCB $20,$30,$20,$20,$20,$20,$70,$0
	FCB $70,$88,$80,$40,$20,$10,$F8,$0
	FCB $F8,$40,$20,$40,$80,$88,$70,$0
	FCB $40,$60,$50,$48,$F8,$40,$40,$0
	FCB $F8,$8,$78,$80,$80,$88,$70,$0
	FCB $60,$10,$8,$78,$88,$88,$70,$0
	FCB $F8,$80,$40,$20,$10,$10,$10,$0
	FCB $70,$88,$88,$70,$88,$88,$70,$0
	FCB $70,$88,$88,$F0,$80,$40,$30,$0
	FCB $0,$30,$30,$0,$30,$30,$0,$0
	FCB $0,$30,$30,$0,$30,$20,$10,$0
	FCB $40,$20,$10,$8,$10,$20,$40,$0
	FCB $0,$0,$F8,$0,$F8,$0,$0,$0
	FCB $10,$20,$40,$80,$40,$20,$10,$0
	FCB $70,$88,$80,$40,$20,$0,$20,$0
	FCB $70,$88,$80,$B0,$A8,$A8,$70,$0
	FCB $20,$50,$88,$88,$F8,$88,$88,$0
	FCB $78,$88,$88,$F8,$88,$88,$78,$0
	FCB $70,$88,$8,$8,$8,$88,$70,$0
	FCB $38,$48,$88,$88,$88,$48,$38,$0
	FCB $F8,$8,$8,$78,$8,$8,$F8,$0
	FCB $F8,$8,$8,$78,$8,$8,$8,$0
	FCB $70,$88,$8,$E8,$88,$88,$70,$0
	FCB $88,$88,$88,$F8,$88,$88,$88,$0
	FCB $70,$20,$20,$20,$20,$20,$70,$0
	FCB $E0,$40,$40,$40,$40,$48,$30,$0
	FCB $88,$48,$28,$18,$28,$48,$88,$0
	FCB $8,$8,$8,$8,$8,$8,$F8,$0
	FCB $88,$D8,$A8,$A8,$88,$88,$88,$0
	FCB $88,$88,$98,$A8,$C8,$88,$88,$0
	FCB $70,$88,$88,$88,$88,$88,$70,$0
	FCB $78,$88,$88,$78,$8,$8,$8,$0
	FCB $70,$88,$88,$88,$A8,$48,$B0,$0
	FCB $78,$88,$88,$78,$28,$48,$88,$0
	FCB $70,$88,$8,$70,$80,$88,$70,$0
	FCB $F8,$20,$20,$20,$20,$20,$20,$0
	FCB $88,$88,$88,$88,$88,$88,$70,$0
	FCB $88,$88,$88,$88,$88,$50,$20,$0
	FCB $88,$88,$88,$A8,$A8,$D8,$88,$0
	FCB $88,$88,$50,$20,$50,$88,$88,$0
	FCB $88,$88,$50,$20,$20,$20,$20,$0
	FCB $F8,$80,$40,$20,$10,$8,$F8,$0
	FCB $70,$10,$10,$10,$10,$10,$70,$0
	FCB $0,$8,$10,$20,$40,$80,$0,$0
	FCB $70,$40,$40,$40,$40,$40,$70,$0
	FCB $20,$50,$88,$0,$0,$0,$0,$0
	FCB $0,$0,$0,$0,$0,$0,$F8,$0
	FCB $8,$10,$20,$0,$0,$0,$0,$0
	FCB $0,$0,$70,$80,$F0,$88,$F0,$0
	FCB $8,$8,$8,$78,$88,$88,$78,$0
	FCB $0,$0,$70,$88,$8,$88,$70,$0
	FCB $80,$80,$80,$F0,$88,$88,$F0,$0
	FCB $0,$0,$70,$88,$F8,$8,$70,$0
	FCB $60,$90,$10,$38,$10,$10,$10,$0
	FCB $0,$0,$F0,$88,$F0,$80,$70,$0
	FCB $8,$8,$8,$78,$88,$88,$88,$0
	FCB $0,$20,$0,$30,$20,$20,$70,$0
	FCB $40,$0,$40,$40,$40,$48,$30,$0
	FCB $8,$8,$48,$28,$18,$28,$48,$0
	FCB $30,$20,$20,$20,$20,$20,$70,$0
	FCB $0,$0,$58,$A8,$A8,$88,$88,$0
	FCB $0,$0,$68,$98,$88,$88,$88,$0
	FCB $0,$0,$70,$88,$88,$88,$70,$0
	FCB $0,$0,$78,$88,$F8,$8,$8,$0
	FCB $0,$0,$F0,$88,$F0,$80,$80,$0
	FCB $0,$0,$68,$98,$8,$8,$8,$0
	FCB $0,$0,$70,$8,$70,$80,$78,$0
	FCB $10,$10,$38,$10,$10,$90,$60,$0
	FCB $0,$0,$88,$88,$88,$C8,$B0,$0
	FCB $0,$0,$88,$88,$88,$50,$20,$0
	FCB $0,$0,$88,$A8,$A8,$A8,$50,$0
	FCB $0,$0,$88,$50,$20,$50,$88,$0
	FCB $0,$0,$88,$88,$F0,$80,$70,$0
	FCB $0,$0,$F8,$40,$20,$10,$F8,$0
	FCB $40,$20,$20,$10,$20,$20,$40,$0
	FCB $20,$20,$20,$0,$20,$20,$20,$0
	FCB $10,$20,$20,$40,$20,$20,$10,$0
	FCB $40,$A8,$10,$0,$0,$0,$0,$0
	FCB $0,$0,$0,$0,$0,$0,$0,$0

clrscr:
        SECTION sect_clrscr
		PHA
        LDA $2A
        PHA
        LDA $2B
        PHA
        LDA # $4
        STA $FFE1
        STA $2A
        LDA # $5
        STA $FFE2
        STA $2B
		LDA # $40
		STA $2E
		STZ $2D
		LDY # $0
		LDA # $80
		STA $2F
		TSX
		LDA $103,X
		.loop:
			STA $2D,Y
			INY
			BNE .loop
				INC $2E
				DEC $2F
		BNE .loop
        PLA
        STA $FFE2
        STA $2B
        PLA
        STA $FFE1
        STA $2A
		PLA
		JSR test_funcA
		JSR test_funcB
        ENDSECTION
        RTS

putc:
        SECTION sect_putc
		PHA
		PHX
		PHY
        LDA $2A
        PHA
        LDA $2B
        PHA
        LDA # $4
        STA $FFE1
        STA $2A
        LDA # $5
        STA $FFE2
        STA $2B
		TSX
		LDA $105,X
		CMP # $8
		BNE .not_backspace
			LDA $22
			BNE .backspace
				JMP .putc_ret
		.backspace:
			DEC $22
			LDA # ' '
			BRA .passed_checks
		.not_backspace:
			CMP # $D
			BNE .no_newline
				STZ $22
				LDA $23
				CMP # $10
				BNE .newline
					BRK
					JMP .putc_ret
		.newline:
			INC $23
			LDA $23
			CMP # $10
			BNE .newline_done
				JSR .putc_scroll
				DEC $23
		.newline_done:
			JMP .putc_ret
		.no_newline:
			CMP # ' '
			BCC .failed_checks
				CMP # $7F
				BCS .failed_checks
					LDX $22
					CPX # $2A
					BCS .failed_checks
						LDX $23
						CPX # $10
						BCS .failed_checks
							BRA .passed_checks
		.failed_checks:
			JMP .putc_ret
		.passed_checks:
		SEC
		SBC # $20
